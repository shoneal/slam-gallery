const covers = {
  CalebWilson: {
    title: "Caleb Wilson",
    date: new Date("2025-11-19"),
    number: "014",
    league: "College",
    team: ["North Carolina"],
    players: ["Caleb Wilson"],
    photos: 6,
  },
  JasonCroweJr: {
    title: "Jason Crowe Jr.",
    date: new Date("2025-11-17"),
    number: "006",
    league: "High School",
    team: ["Inglewood"],
    players: ["Jason Crowe Jr."],
    photos: 8,
  },
  LaurenSiennaBetts: {
    title: "Lauren & Sienna Betts",
    date: new Date("2025-11-05"),
    number: "012",
    league: "College",
    team: ["UCLA"],
    players: ["Sienna Betts", "Lauren Betts"],
    photos: 7,
  },
  AzziFudd: {
    title: "Azzi Fudd",
    date: new Date("2025-10-22"),
    number: "259",
    league: "College",
    team: ["UConn"],
    players: ["Azzi Fudd"],
    photos: 6,
  },
  AJDybantsa: {
    title: "AJ Dybantsa",
    date: new Date("2025-10-21"),
    number: "259",
    league: "College",
    team: ["BYU"],
    players: ["AJ Dybantsa"],
    photos: 7,
  },
  JalenWilliams: {
    title: "Jalen Williams",
    date: new Date("2025-09-17"),
    number: 258,
    league: "NBA",
    team: ["Oklahoma City Thunder"],
    players: ["Jalen Williams"],
    photos: 8,
  },
  CooperFlagg: {
    title: "Cooper Flagg",
    date: new Date("2025-08-26"),
    number: 258,
    league: "NBA",
    team: ["Dallas Mavericks"],
    players: ["Cooper Flagg"],
    photos: 7,
  },
  JaMorant: {
    title: "Ja Morant",
    date: new Date("2025-08-20"),
    league: "Other",
    team: ["Memphis Grizzlies"],
    players: ["Ja Morant"],
    photos: 4,
  },
  AusarThompsonAmenThompson: {
    title: "Ausar Thompson & Amen Thompson",
    date: new Date("2025-07-22"),
    number: 257,
    league: "NBA",
    team: ["Houston Rockets"],
    players: ["Amen Thompson", "Ausar Thompson"],
    photos: 10,
  },
  AliyahBoston: {
    title: "Aliyah Boston",
    date: new Date("2025-07-17"),
    number: "ASW",
    league: "WNBA",
    team: ["Indiana Fever"],
    players: ["Aliyah Boston"],
    photos: 4,
  },
  NapheesaCollier: {
    title: "Napheesa Collier",
    date: new Date("2025-06-30"),
    number: 257,
    league: "WNBA",
    team: ["Minnesota Lynx"],
    players: ["Napheesa Collier"],
    photos: 6,
  },
  CameronCaydenBoozer: {
    title: "Cameron & Cayden Boozer",
    date: new Date("2025-06-12"),
    number: "010",
    league: "College",
    team: ["Duke"],
    players: ["Cameron Boozer", "Cayden Boozer"],
    photos: 7,
  },
  NatashaCloud: {
    title: "Natasha Cloud",
    date: new Date("2025-05-27"),
    number: 256,
    league: "WNBA",
    team: ["New York Liberty"],
    players: ["Natasha Cloud"],
    photos: 7,
  },
  LosAngelesSparks: {
    title: "Los Angeles Sparks",
    date: new Date("2025-05-23"),
    number: 256,
    league: "WNBA",
    team: ["Los Angeles Sparks"],
    players: [
      "Kelsey Plum",
      "Dearica Hamby",
      "Cameron Brink",
      "Rickea Jackson",
    ],
    photos: 11,
  },
  CaitlinClark: {
    title: "Caitlin Clark",
    date: new Date("2025-05-19"),
    number: 256,
    league: "WNBA",
    team: ["Indiana Fever"],
    players: ["Caitlin Clark"],
    photos: 3,
  },
  PhoenixMercury: {
    title: "Phoenix Mercury",
    date: new Date("2025-05-12"),
    number: 256,
    league: "WNBA",
    team: ["Phoenix Mercury"],
    players: ["Kahleah Copper", "Satou Sabally", "Alyssa Thomas"],
    photos: 7,
  },
  CadeCunningham: {
    title: "Cade Cunningham",
    date: new Date("2025-04-09"),
    number: 255,
    league: "NBA",
    team: ["Detroit Pistons"],
    players: ["Cade Cunningham"],
    photos: 6,
  },
  DariusGarlandDonovanMitchell: {
    title: "Darius Garland & Donovan Mitchell",
    date: new Date("2025-03-24"),
    number: 255,
    league: "NBA",
    team: ["Cleveland Cavaliers"],
    players: ["Darius Garland", "Donovan Mitchell"],
    photos: 4,
  },
  JarenJacksonJr: {
    title: "Jaren Jackson Jr.",
    date: new Date("2025-03-20"),
    number: 255,
    league: "NBA",
    team: ["Memphis Grizzlies"],
    players: ["Jaren Jackson Jr."],
    photos: 8,
  },
  LSU: {
    title: "LSU",
    date: new Date("2025-02-28"),
    number: "005",
    league: "College",
    team: ["LSU"],
    players: ["Mikaylah Williams", "Flau’jae Johnson", "Aneesah Morrow"],
    photos: 6,
  },
  StJohnsRedStorm: {
    title: "St. John's Red Storm",
    date: new Date("2025-02-10"),
    number: "004",
    league: "College",
    team: ["St. John’s Red Storm"],
    players: ["RJ Luis Jr.", "Zuby Ejiofor", "Kadary Richmond", "Rick Pitino"],
    photos: 5,
  },
  KarlAnthonyTowns: {
    title: "Karl-Anthony Towns",
    date: new Date("2025-01-23"),
    number: 254,
    league: "NBA",
    team: ["New York Knicks"],
    players: ["Karl-Anthony Towns"],
    photos: 5,
  },
  ShaiGilgeousAlexander: {
    title: "Shai Gilgeous-Alexander",
    date: new Date("2025-02-14"),
    number: 254,
    league: "NBA",
    team: ["Oklahoma City Thunder"],
    players: ["Shai Gilgeous-Alexander"],
    photos: 4,
  },
  HoustonRockets: {
    title: "Houston Rockets",
    date: new Date("2025-02-05"),
    number: 254,
    league: "NBA",
    team: ["Houston Rockets"],
    players: [
      "Alperen Sengun",
      "Dillon Brooks",
      "Fred VanVleet",
      "Jalen Green",
    ],
    photos: 6,
  },
  IowaState: {
    title: "Iowa State",
    date: new Date("2025-01-14"),
    number: "002",
    league: "College",
    team: ["Iowa State"],
    players: ["Curtis Jones", "Keshon Gilber"],
    photos: 5,
  },
  AceBaileyDylanHarper: {
    title: "Ace Bailey & Dylan Harper",
    date: new Date("2024-10-16"),
    number: 253,
    league: "College",
    team: ["Rutgers"],
    players: ["Dylan Harper", "Ace Bailey"],
    photos: 6,
  },
  DamianLillard: {
    title: "Damian Lillard",
    date: new Date("2024-10-03"),
    number: 252,
    league: "NBA",
    team: ["Milwaukee Bucks"],
    players: ["Damian Lillard"],
    photos: 4,
  },
  DerrickWhiteJrueHoliday: {
    title: "Derrick White & Jrue Holiday",
    date: new Date("2024-09-30"),
    number: 252,
    league: "NBA",
    team: ["Boston Celtics"],
    players: ["Derrick White", "Jrue Holiday"],
    photos: 5,
  },
  AlyssaThomasDeWannaBonner: {
    title: "Alyssa Thomas & DeWanna Bonner",
    date: new Date("2024-07-18"),
    number: 251,
    league: "WNBA",
    team: ["Connecticut Sun"],
    players: ["Alyssa Thomas", "DeWanna Bonner"],
    photos: 4,
  },
  DawnStaley: {
    title: "Dawn Staley",
    date: new Date("2024-05-30"),
    number: 250,
    league: "College",
    team: ["South Carolina"],
    players: ["Dawn Staley"],
    photos: 4,
  },
  StephonCastleDonovanClingan: {
    title: "Stephon Castle & Donovan Clingan",
    date: new Date("2024-06-05"),
    number: 250,
    league: "College",
    team: ["UConn"],
    players: ["Stephon Castle", "Donovan Clingan"],
    photos: 6,
  },
  JimmyButler: {
    title: "Jimmy Butler",
    date: new Date("2024-04-15"),
    number: 249,
    league: "NBA",
    team: ["Miami Heat"],
    players: ["Jimmy Butler"],
    photos: 6,
  },
  NewYorkKnicks: {
    title: "New York Knicks",
    date: new Date("2024-04-10"),
    number: 249,
    league: "NBA",
    team: ["New York Knicks"],
    players: ["Jalen Brunson", "Josh Hart", "Donte DiVincenzo"],
    photos: 6,
  },
  CaitlinClark2: {
    title: "Caitlin Clark",
    date: new Date("2024-03-21"),
    number: 249,
    league: "College",
    team: ["Iowa"],
    players: ["Caitlin Clark"],
    photos: 8,
  },
  ChetHolmgren: {
    title: "Chet Holmgren",
    date: new Date("2024-02-12"),
    number: 248,
    league: "NBA",
    team: ["Oklahoma City Thunder"],
    players: ["Chet Holmgren"],
    photos: 4,
  },
  JujuWatkins: {
    title: "Juju Watkins",
    date: new Date("2024-02-05"),
    number: 248,
    league: "College",
    team: ["USC"],
    players: ["Juju Watkins"],
    photos: 9,
  },
  TyreseMaxey: {
    title: "Tyrese Maxey",
    date: new Date("2024-01-31"),
    number: 248,
    league: "NBA",
    team: ["Philadelphia 76ers"],
    players: ["Tyrese Maxey"],
    photos: 8,
  },
  CooperFlagg2: {
    title: "Cooper Flagg",
    date: new Date("2023-10-30"),
    number: 247,
    league: "College",
    team: ["Duke"],
    players: ["Cooper Flagg"],
    photos: 5,
  },
  OklahomaCityThunder: {
    title: "Oklahoma City Thunder",
    date: new Date("2023-10-23"),
    number: 247,
    league: "NBA",
    team: ["Oklahoma City Thunder"],
    players: [
      "Shai Gilgeous-Alexander",
      "Lu Dort",
      "Chet Holmgren",
      "Josh Giddey",
      "Jalen Williams",
    ],
    photos: 15,
  },
  PaulGeorge: {
    title: "Paul George",
    date: new Date("2023-09-27"),
    number: 246,
    league: "NBA",
    team: ["Los Angeles Clippers"],
    players: ["Paul George"],
    photos: 7,
  },
  NewYorkLiberty: {
    title: "New York Liberty",
    date: new Date("2023-09-12"),
    number: 246,
    league: "WNBA",
    team: ["New York Liberty"],
    players: [
      "Breanna Stewart",
      "Jonquel Jones",
      "Sabrina Ionescu",
      "Betnijah Laney",
      "Courtney Vandersloot",
    ],
    photos: 13,
  },
  SLAMKICKSExclusive: {
    title: "SLAMKICKS Exclusive",
    date: new Date("2023-08-28"),
    league: "Other",
    team: ["New Orleans Pelicans", "Boston Celtics", "Dallas Mavericks"],
    players: ["Zion Williamson", "Jayson Tatum", "Luka Dončić"],
    photos: 8,
  },
  PJTucker: {
    title: "P.J. Tucker",
    date: new Date("2023-08-31"),
    league: "Other",
    team: ["Philadelphia 76ers"],
    players: ["P.J. Tucker"],
    photos: 7,
  },
  BradleyBeal: {
    title: "Bradley Beal",
    date: new Date("2023-07-26"),
    number: 245,
    league: "NBA",
    team: ["Phoenix Suns"],
    players: ["Bradley Beal"],
    photos: 5,
  },
  TyreseHaliburton: {
    title: "Tyrese Haliburton",
    date: new Date("2023-07-20"),
    number: 245,
    league: "NBA",
    team: ["Indiana Pacers"],
    players: ["Tyrese Haliburton"],
    photos: 9,
  },
  PaoloBanchero: {
    title: "Paolo Banchero",
    date: new Date("2023-05-24"),
    number: 244,
    league: "NBA",
    team: ["Orlando Magic"],
    players: ["Paolo Banchero"],
    photos: 8,
  },
  RhyneHoward: {
    title: "Rhyne Howard",
    date: new Date("2023-05-19"),
    number: 244,
    league: "WNBA",
    team: ["Atlanta Dream"],
    players: ["Rhyne Howard"],
    photos: 6,
  },
  ScootHenderson: {
    title: "Scoot Henderson",
    date: new Date("2023-05-17"),
    number: 244,
    league: "NBA",
    team: ["Portland Trail Blazers"],
    players: ["Scoot Henderson"],
    photos: 10,
  },
  AngelReeseFlaujaeJohnson: {
    title: "Angel Reese & Flau'jae Johnson",
    date: new Date("2023-03-13"),
    number: 243,
    league: "College",
    team: ["LSU"],
    players: ["Angel Reese", "Flau'jae Johnson"],
    photos: 9,
  },
  JamesHarden: {
    title: "James Harden",
    date: new Date("2023-04-12"),
    number: 243,
    league: "NBA",
    team: ["Philadelphia 76ers"],
    players: ["James Harden"],
    photos: 7,
  },
  LauriMarkkanenJordanClarkson: {
    title: "Lauri Markkanen & Jordan Clarkson",
    date: new Date("2023-04-03"),
    number: 243,
    league: "NBA",
    team: ["Utah Jazz"],
    players: ["Lauri Markkanen", "Jordan Clarkson"],
    photos: 7,
  },
  JalenBrunson: {
    title: "Jalen Brunson",
    date: new Date("2023-03-30"),
    number: 243,
    league: "NBA",
    team: ["New York Knicks"],
    players: ["Jalen Brunson"],
    photos: 4,
  },
  NewOrleansPelicans: {
    title: "New Orleans Pelicans",
    date: new Date("2023-02-08"),
    number: 242,
    league: "NBA",
    team: ["New Orleans Pelicans"],
    players: ["Zion Williamson", "CJ McCollum", "Brandon Ingram"],
    photos: 4,
  },
  JaylenBrown: {
    title: "Jaylen Brown",
    date: new Date("2023-02-02"),
    number: 242,
    league: "NBA",
    team: ["Boston Celtics"],
    players: ["Jaylen Brown"],
    photos: 4,
  },
  DeAaronFoxDomantasSabonis: {
    title: "De'Aaron Fox & Domantas Sabonis",
    date: new Date("2023-01-26"),
    number: 242,
    league: "NBA",
    team: ["Sacramento Kings"],
    players: ["De'Aaron Fox", "Domantas Sabonis"],
    photos: 5,
  },
  TraeYoungDejounteMurray: {
    title: "Trae Young & Dejounte Murray",
    date: new Date("2022-12-13"),
    number: 242,
    league: "NBA",
    team: ["Atlanta Hawks"],
    players: ["Trae Young", "Dejounte Murray"],
    photos: 5,
  },
  JaysonTatum: {
    title: "Jayson Tatum",
    date: new Date("2022-12-08"),
    number: 241,
    league: "NBA",
    team: ["Boston Celtics"],
    players: ["Jayson Tatum"],
    photos: 5,
  },
  KawhiLeonardPaulGeorge: {
    title: "Kawhi Leonard & Paul George",
    date: new Date("2022-10-17"),
    number: 240,
    league: "NBA",
    team: ["Los Angeles Clippers"],
    players: ["Kawhi Leonard", "Paul George"],
    photos: 3,
  },
  VictorWembanyama: {
    title: "Victor Wembanyama",
    date: new Date("2022-10-03"),
    number: 240,
    league: "Europe",
    team: ["Metropolitans 92"],
    players: ["Victor Wembanyama"],
    photos: 6,
  },
  ScottieBarnes: {
    title: "Scottie Barnes",
    date: new Date("2022-07-29"),
    number: 239,
    league: "NBA",
    team: ["Toronto Raptors"],
    players: ["Scottie Barnes"],
    photos: 4,
  },
  CadeCunningham2: {
    title: "Cade Cunningham",
    date: new Date("2022-05-26"),
    number: 238,
    league: "NBA",
    team: ["Detroit Pistons"],
    players: ["Cade Cunningham"],
    photos: 5,
  },
  MemphisGrizzlies: {
    title: "Memphis Grizzlies",
    date: new Date("2022-04-15"),
    number: 238,
    league: "NBA",
    team: ["Memphis Grizzlies"],
    players: [
      "Ja Morant",
      "Desmond Bane",
      "Jaren Jackson Jr.",
      "Dillon Brooks",
    ],
    photos: 5,
  },
  SouthCarolinaGamecocks: {
    title: "South Carolina Gamecocks",
    date: new Date("2022-03-17"),
    number: 238,
    league: "College",
    team: ["South Carolina"],
    players: [
      "Dawn Staley",
      "Zia Cooke",
      "Destanni Henderson",
      "Aliyah Boston",
    ],
    photos: 5,
  },
  LaMeloBall: {
    title: "LaMelo Ball",
    date: new Date("2022-03-30"),
    number: 237,
    league: "NBA",
    team: ["Charlotte Hornets"],
    players: ["LaMelo Ball"],
    photos: 5,
  },
  DeMarDeRozanZachLaVine: {
    title: "DeMar DeRozan & Zach LaVine",
    date: new Date("2022-02-01"),
    number: 237,
    league: "NBA",
    team: ["Chicago Bulls"],
    players: ["DeMar DeRozan", "Zach LaVine"],
    photos: 3,
  },
  KahleahCopper: {
    title: "Kahleah Copper",
    date: new Date("2022-01-27"),
    number: 236,
    league: "WNBA",
    team: ["Chicago Sky"],
    players: ["Kahleah Copper"],
    photos: 5,
  },
  DonovanMitchell: {
    title: "Donovan Mitchell",
    date: new Date("2021-12-02"),
    number: 235,
    league: "NBA",
    team: ["Utah Jazz"],
    players: ["Donovan Mitchell"],
    photos: 5,
  },
  AzziFuddPaigeBueckers: {
    title: "Azzi Fudd & Paige Bueckers",
    date: new Date("2021-11-30"),
    number: 235,
    league: "College",
    team: ["UConn"],
    players: ["Azzi Fudd", "Paige Bueckers"],
    photos: 5,
  },
  CandaceParker: {
    title: "Candace Parker",
    date: new Date("2021-07-12"),
    number: 233,
    league: "WNBA",
    team: ["Chicago Sky"],
    players: ["Candace Parker"],
    photos: 4,
  },
  WNBARevolution: {
    title: "WNBA Revolution",
    date: new Date("2021-05-12"),
    number: 232,
    league: "WNBA",
    team: ["Phoenix Mercury", "Los Angeles Sparks", "Seattle Storm"],
    players: [
      "Skylar Diggins-Smith",
      "Nneka Ogwumike",
      "Sue Bird",
      "Diana Taurasi",
    ],
    photos: 5,
  },
  JamalMurray: {
    title: "Jamal Murray",
    date: new Date("2020-12-23"),
    number: 230,
    league: "NBA",
    team: ["Denver Nuggets"],
    players: ["Jamal Murray"],
    photos: 5,
  },
  ZionWilliamson: {
    title: "Zion Williamson",
    date: new Date("2020-08-06"),
    number: 228,
    league: "College",
    team: ["Duke"],
    players: ["Zion Williamson"],
    photos: 6,
  },
  JaMorant2: {
    title: "Ja Morant",
    date: new Date("2020-03-16"),
    number: 227,
    league: "NBA",
    team: ["Memphis Grizzlies"],
    players: ["Ja Morant"],
    photos: 5,
  },
  BostonCeltics: {
    title: "Boston Celtics",
    date: new Date("2020-01-30"),
    number: 226,
    league: "NBA",
    team: ["Boston Celtics"],
    players: [
      "Marcus Smart",
      "Jayson Tatum",
      "Jaylen Brown",
      "Kemba Walker",
      "Gordon Hayward",
    ],
    photos: 6,
  },
  MiamiHeat: {
    title: "Miami Heat",
    date: new Date("2019-12-03"),
    number: 225,
    league: "NBA",
    team: ["Miami Heat"],
    players: ["Jimmy Butler", "Bam Adebayo", "Tyler Herro"],
    photos: 5,
  },
  Goodfellas: {
    title: "Goodfellas",
    date: new Date("2019-10-17"),
    number: 224,
    league: "NBA",
    team: ["Minnesota Timberwolves", "Phoenix Suns", "Golden State Warriors"],
    players: ["Karl-Anthony Towns", "Devin Booker", "D’Angelo Russell"],
    photos: 5,
  },
  NewOrleansPelicans2: {
    title: "New Orleans Pelicans",
    date: new Date("2019-10-21"),
    number: 224,
    league: "NBA",
    team: ["New Orleans Pelicans"],
    players: [
      "Zion Williamson",
      "Lonzo Ball",
      "Brandon Ingram",
      "Jrue Holiday",
    ],
    photos: 7,
  },
  LizCambageAjaWilson: {
    title: "Liz Cambage & A’ja Wilson",
    date: new Date("2019-07-16"),
    number: 223,
    league: "WNBA",
    team: ["Las Vegas Aces"],
    players: ["Liz Cambage", "A’ja Wilson"],
    photos: 5,
  },
  LouWilliams: {
    title: "Lou Williams",
    date: new Date("2019-07-17"),
    number: 223,
    league: "NBA",
    team: ["Los Angeles Clippers"],
    players: ["Lou Williams"],
    photos: 4,
  },
  JaMorant3: {
    title: "Ja Morant",
    date: new Date("2019-05-14"),
    number: 222,
    league: "College",
    team: ["Murray State"],
    players: ["Ja Morant"],
    photos: 7,
  },
  ZionWilliamson2: {
    title: "Zion Williamson",
    date: new Date("2019-05-13"),
    number: 222,
    league: "College",
    team: ["Duke"],
    players: ["Zion Williamson"],
    photos: 4,
  },
  DwyaneWade: {
    title: "Dwyane Wade",
    date: new Date("2019-03-22"),
    number: 221,
    league: "NBA",
    team: ["Miami Heat"],
    players: ["Dwyane Wade"],
    photos: 4,
  },
  KembaWalker: {
    title: "Kemba Walker",
    date: new Date("2019-01-28"),
    number: 220,
    league: "NBA",
    team: ["Charlotte Hornets"],
    players: ["Kemba Walker"],
    photos: 5,
  },
  LeBronJames: {
    title: "LeBron James",
    date: new Date("2019-01-30"),
    number: 220,
    league: "NBA",
    team: ["Los Angeles Lakers"],
    players: ["LeBron James"],
    photos: 12,
  },
  StephenCurry: {
    title: "Stephen Curry",
    date: new Date("2018-12-03"),
    number: 219,
    league: "NBA",
    team: ["Golden State Warriors"],
    players: ["Stephen Curry"],
    photos: 8,
  },
  RJBarrett: {
    title: "RJ Barrett",
    date: new Date("2018-10-15"),
    number: 218,
    league: "College",
    team: ["Duke"],
    players: ["RJ Barrett"],
    photos: 5,
  },
  JaysonTatum2: {
    title: "Jayson Tatum",
    date: new Date("2018-10-11"),
    number: 218,
    league: "NBA",
    team: ["Boston Celtics"],
    players: ["Jayson Tatum"],
    photos: 8,
  },
}; // Главная константа

const basicLink = "https://shoneal.github.io/slam-gallery/images/covers/";

// Всё, что касается шапки с изображениями
const randomCovers = Object.keys(covers)
  .sort(() => Math.random() - 0.5)
  .slice(0, 20); // 20 случайных обложек
const header = document.querySelector(".header");
const animationList = document.querySelector(".animation_list");
const getImageExtension = (itemKey) => {
  const extensionMap = { LaMeloBall: "png" };
  return extensionMap[itemKey] || "jpg";
};
const loadImageWithFallback = (element, name) => {
  element.src = `${basicLink}${name}/thumb.${getImageExtension(name)}`;
  element.onload = () => (element.style.opacity = "1");
};
const addRandomImages = () => {
  let loaded = 0;
  const total = randomCovers.length;
  randomCovers.forEach((image, index) => {
    const item = document.createElement("div");
    item.classList.add("animation_item");
    item.style.transform = `rotate(${
      index * 18
    }deg) translateY(calc(-1 * 970px))`;
    const img = document.createElement("img");
    img.alt = "SLAM Cover";
    loadImageWithFallback(img, image, () => {
      loaded++;
      if (loaded === total) animationList.style.opacity = "1";
    });
    item.appendChild(img);
    animationList.appendChild(item);
  });
}; // Добавление обложек в шапку в HTML и их анимация
let startScroll = 0;
let maxScroll = 0;
let currentRotateZ = 0;
function getCSSVariable(variableName) {
  const value = getComputedStyle(document.documentElement).getPropertyValue(
    variableName
  );
  return parseFloat(value);
}
function updateStyles(scroll) {
  const windowWidth = window.innerWidth;
  const baseScroll = windowWidth > 768 ? 100 : 0;
  const currentScroll = scroll - baseScroll;

  if (currentScroll >= 0) {
    currentRotateZ = currentScroll * 0.1;
    if (currentRotateZ > 180) {
      currentRotateZ = 180;
      maxScroll = scroll;
    }
  } else {
    currentRotateZ = 0;
  }
  animationList.style.transform = `translate3d(0px, 1100px, 0px) scale3d(1.25, 1.25, 1) rotateX(0deg) rotateY(0deg) rotateZ(${currentRotateZ}deg) skew(0deg, 0deg)`;

  const baseColor = getCSSVariable("--animation-back-color");
  const colorProgress = (scroll / window.innerHeight) * 2;
  const r = Math.round(baseColor * colorProgress);
  const g = Math.round(baseColor * colorProgress);
  const b = Math.round(baseColor * colorProgress);
  header.style.backgroundColor = `rgb(${18 + r}, ${18 + g}, ${18 + b})`;
  header.style.color = `rgb(${255 - r}, ${255 - g}, ${255 - b})`;
}

const stickyElement = document.querySelector(".navigation");
function calculateThreshold() {
  const headerHeight = header ? header.getBoundingClientRect().height : 0;
  const offset = window.innerWidth > 768 ? 55 : 100;
  return headerHeight - offset;
}
function checkStickyPosition() {
  const scrollTop = window.scrollY;
  const threshold = calculateThreshold();
  if (scrollTop >= threshold) {
    stickyElement.classList.add("has-border");
  } else {
    stickyElement.classList.remove("has-border");
  }
}

// Всё, что касается логики открытия и закрытия попапов
let openPopups = []; // Открытые попапы
let currentSlide = 0;
let isOpen = false;
let keydownListenerAdded = false;
let galleryListenersAdded = false;
let currentPhotosArray = [];
function lockBody() {
  const body = document.body;
  const scrollPosition = window.scrollY;
  body.dataset.scrollPosition = scrollPosition;
  body.style.top = `-${scrollPosition}px`;
  body.classList.add("scroll-lock");
}
function unlockBody() {
  const body = document.body;
  const scrollPosition = body.dataset.scrollPosition;
  body.style.top = "";
  body.classList.remove("scroll-lock");
  window.scrollTo(0, scrollPosition);
}
function openPopup(popup) {
  popup.addEventListener("click", (event) => {
    if (event.target === popup) {
      closePopup(popup);
    }
  });
  popup.style.display = "flex";
  openPopups.push(popup);
  if (
    popup.classList.contains("gallery-popup") ||
    (popup.classList.contains("navigation-popup") && window.innerWidth < 767)
  ) {
    lockBody();
  }
  if (popup.classList.contains("slide-popup")) {
    isOpen = true;
    currentSlide = currentSlide || 0;
  }
} // Функция отркытия попапов
function closePopup(popup) {
  popup.style.display = "none";
  openPopups.splice(openPopups.indexOf(popup), 1);
  if (
    popup.classList.contains("gallery-popup") ||
    (popup.classList.contains("navigation-popup") && window.innerWidth < 767)
  ) {
    unlockBody();
    try {
      if (galleryListenersAdded) {
        gallery.removeEventListener("click", handleGalleryClick);
        galleryListenersAdded = false;
      }
    } catch (error) {
      // Если слушатель уже удален или не существует, просто игнорируем ошибку
    }
    currentIndex = currentSlide;
    currentPhotosArray = [];
  }
  if (popup.classList.contains("slide-popup")) {
    isOpen = false;
    keydownListenerAdded = false;
  }
} // Функция закрытия попапов
function closeAllPopupsOnEsc(event) {
  if (event.key === "Escape" && openPopups.length > 0) {
    const lastPopup = openPopups[openPopups.length - 1];
    closePopup(lastPopup);
  }
} // Функция нажатия вне попапа
document.querySelectorAll(".close").forEach((closeButton) => {
  closeButton.addEventListener("click", () => {
    const popup = closeButton.closest(".popup");
    closePopup(popup);
  });
}); // Обработчики закрытия попапов на кнопки закрытия
document.addEventListener("click", (event) => {
  if (openPopups.length > 0 && event.target === document.body) {
    const lastPopup = openPopups[openPopups.length - 1];
    closePopup(lastPopup);
  }
}); // Действия при клике вне попапа
document.addEventListener("keydown", closeAllPopupsOnEsc); // Нажатие на ESC

// Всё, что касается попапа с чекбоксами
const uniqueLeagues = [
  "NBA",
  "WNBA",
  "College",
  "High School",
  "Europe",
  "Other",
];
function getTopPlayers(covers, topCount = 3) {
  const playerCount = Object.values(covers).reduce((acc, cover) => {
    cover.players.forEach((p) => (acc[p] = (acc[p] || 0) + 1));
    return acc;
  }, {});

  const teamFrequency = Object.values(covers).reduce((acc, cover) => {
    cover.team.forEach((t) => (acc[t] = (acc[t] || 0) + 1));
    return acc;
  }, {});

  return Object.entries(playerCount)
    .map(([player, count]) => {
      const teams = Object.values(covers)
        .filter((c) => c.players.includes(player))
        .flatMap((c) => c.team.filter(Boolean));

      const mainTeam = teams[0] || "Unknown";
      return {
        player,
        count,
        team: mainTeam,
        teamCount: teamFrequency[mainTeam] || 0,
      };
    })
    .sort(
      (a, b) =>
        b.count - a.count ||
        b.teamCount - a.teamCount ||
        a.player.localeCompare(b.player)
    )
    .slice(0, topCount)
    .map(({ player }) => player);
}
const topPlayers = getTopPlayers(covers); // Вывод часто повторяющихся игроков
const checkboxContainers = document.querySelector(".checkbox-containers");
function createCheckbox(labelText, container, type) {
  const label = document.createElement("label");
  label.classList.add("checkbox-label");
  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.name = type;
  const textSpan = document.createElement("span");
  textSpan.textContent = labelText;
  label.appendChild(checkbox);
  label.appendChild(textSpan);
  container.appendChild(label);
  return checkbox;
} // Функция создания чекбокса
const createContainer = (className) => {
  const container = document.createElement("div");
  container.classList.add("checkbox-container", className);
  return container;
}; // Контейнеры для разных типов чекбоксов
const leaguesContainer = createContainer("leagues");
const teamsContainer = createContainer("teams");
const playersContainer = createContainer("players");
uniqueLeagues.forEach((league) =>
  createCheckbox(league, leaguesContainer, "league")
);
topPlayers.forEach((player) =>
  createCheckbox(player, playersContainer, "player")
);
function createTeamCheckboxes(selectedLeagues = []) {
  teamsContainer.innerHTML = "";
  const teams = Object.values(covers)
    .filter(
      (c) => !selectedLeagues.length || selectedLeagues.includes(c.league)
    )
    .flatMap((c) => c.team)
    .filter(Boolean)
    .reduce((set, t) => set.add(t), new Set());

  Array.from(teams)
    .sort((a, b) => a.localeCompare(b))
    .forEach((team) => createCheckbox(team, teamsContainer, "team"));
} // Функция создания чекбоксов команд исходя из активных чекбоксов лиг
const addTitleAndContainer = (titleText, container) => {
  const title = document.createElement("h2");
  title.textContent = titleText;
  checkboxContainers.appendChild(title);
  checkboxContainers.appendChild(container);
}; // Заголовки и контейнеры в основной контейнер
addTitleAndContainer("Athletes", playersContainer);
addTitleAndContainer("Teams", leaguesContainer);
checkboxContainers.appendChild(teamsContainer);
leaguesContainer.addEventListener("change", (event) => {
  if (event.target.type === "checkbox") {
    const selectedLeagues = Array.from(
      leaguesContainer.querySelectorAll("input:checked"),
      (checkbox) => checkbox.nextElementSibling.textContent
    );
    createTeamCheckboxes(selectedLeagues);
    closePopup(navigationPopup);
  }
}); // Обработчик чекбоксов лиг

const navigationPopup = document.querySelector(".navigation-popup");
const filterButton = document.querySelector(".filter");
filterButton.addEventListener("click", () => {
  openPopup(navigationPopup);
}); // Открытие попапа с навигацией

function filterCovers(
  covers,
  selectedLeagues,
  selectedTeams,
  selectedPlayers,
  searchQuery
) {
  const lowerSearch = searchQuery.toLowerCase();

  return Object.entries(covers)
    .filter(([key, cover]) => {
      const lMatch =
        !selectedLeagues.length || selectedLeagues.includes(cover.league);
      const tMatch =
        !selectedTeams.length ||
        cover.team.some((t) => selectedTeams.includes(t));
      const pMatch =
        !selectedPlayers.length ||
        cover.players.some((p) => selectedPlayers.includes(p));
      const sMatch =
        cover.title.toLowerCase().includes(lowerSearch) ||
        cover.team.some((t) => t.toLowerCase().includes(lowerSearch)) ||
        cover.players.some((p) => p.toLowerCase().includes(lowerSearch));

      return lMatch && tMatch && pMatch && sMatch;
    })
    .sort(([keyA, coverA], [keyB, coverB]) => coverB.date - coverA.date)
    .map(([key, cover]) => ({
      ...cover,
      key,
    }));
} // Фильтрация обложек
const template = document.querySelector("#cover-template");
const container = document.querySelector(".covers_list");
const emptyMessage = document.querySelector(".empty-message");
function renderCover(item) {
  const clone = template.content.cloneNode(true);
  const itemElement = clone.querySelector(".covers_item");
  const img = clone.querySelector(".cover_img");
  const number = clone.querySelector(".cover_number");
  const title = clone.querySelector(".cover_title");

  img.alt =
    item.players.length === 1
      ? `На обложке представлен ${item.players[0]}`
      : `На обложке представлены ${item.players.join(", ")}`;
  loadImageWithFallback(img, item.key);

  number.textContent = item.number || "";
  title.textContent = item.title;

  itemElement.addEventListener("click", () => {
    handlePopup(item);
  });

  return clone;
} // Рендер обложки
function updateFilters() {
  const selectedLeagues = [
    ...document.querySelectorAll(".leagues input:checked"),
  ].map((checkbox) => checkbox.nextElementSibling.textContent);
  const selectedTeams = [
    ...document.querySelectorAll(".teams input:checked"),
  ].map((checkbox) => checkbox.nextElementSibling.textContent);
  const selectedPlayers = [
    ...document.querySelectorAll(".players input:checked"),
  ].map((checkbox) => checkbox.nextElementSibling.textContent);
  const searchQuery = search.value;

  const filteredCovers = filterCovers(
    covers,
    selectedLeagues,
    selectedTeams,
    selectedPlayers,
    searchQuery
  );

  container.innerHTML = "";
  emptyMessage.style.display = filteredCovers.length ? "none" : "block";
  filteredCovers.forEach((cover) => {
    container.appendChild(renderCover(cover));
  });
} // Обновление фильтров

const search = document.querySelector(".search");
const homeButton = document.querySelector(".home_button");
search.addEventListener("input", () => {
  updateFilters();
}); // Обработчик поиска
checkboxContainers.addEventListener("change", (event) => {
  if (event.target.type === "checkbox") {
    updateFilters();
    closePopup(navigationPopup);
    document.querySelector(".main").scrollIntoView({ block: "start" });
  }
}); // Обработчик чекбоксов
homeButton.addEventListener("click", () => {
  Array.from(
    checkboxContainers.querySelectorAll('input[type="checkbox"]')
  ).forEach((checkbox) => {
    checkbox.checked = false;
  });
  search.value = "";
  updateFilters();
  document.querySelector(".main").scrollIntoView({ block: "start" });
}); // Обработчик нажатия на главную кнопку

document.addEventListener("scroll", () => {
  const scroll = window.scrollY || window.pageYOffset;
  updateStyles(scroll);
  requestAnimationFrame(checkStickyPosition);
}); // Действия при скролле
document.addEventListener("wheel", () => {
  const scroll = window.scrollY || window.pageYOffset;
  updateStyles(scroll);
}); // Действия при скролле колесиком
document.addEventListener("DOMContentLoaded", () => {
  const storedTheme = localStorage.getItem("theme");
  if (storedTheme === "dark") {
    document.body.classList.add("dark-theme");
  }

  addRandomImages();
  createTeamCheckboxes();
  updateFilters();
  checkStickyPosition();

  const scroll = window.scrollY || window.pageYOffset;
  updateStyles(scroll);

  const updatePlaceholder = () => {
    search.setAttribute(
      "placeholder",
      window.innerWidth <= 767 ? "" : "Search by Keywords"
    );
  };
  updatePlaceholder();
  window.addEventListener("resize", () => {
    updatePlaceholder();
    requestAnimationFrame(checkStickyPosition);
    openPopups.forEach((popup) => {
      if (popup.classList.contains("navigation-popup")) {
        if (
          window.innerWidth < 767 &&
          !document.body.classList.contains("scroll-lock")
        ) {
          lockBody();
        } else if (
          window.innerWidth >= 767 &&
          document.body.classList.contains("scroll-lock")
        ) {
          unlockBody();
        }
      }
    });
  });
}); // Инициализация функций при открытии сайта

const popupGallery = document.querySelector(".gallery-popup");
const popupGalleryContent = popupGallery.querySelector(".popup-content");
const gallery = popupGallery.querySelector(".gallery");
function handlePopup(item) {
  gallery.innerHTML = "";

  const header = document.createElement("div");
  header.classList.add("popup-header");
  const h2 = document.createElement("h2");
  h2.textContent = item.team.join(", ");
  const h1 = document.createElement("h1");
  h1.textContent = item.players.join(", ");

  header.appendChild(h2);
  header.appendChild(h1);
  gallery.appendChild(header);

  currentPhotosArray = (() => {
    const base = `${basicLink}${item.key}/`;
    const total = 1 + item.photos;
    const ext = getImageExtension(item.key);
    return Array.from(
      { length: total },
      (_, i) => base + (i === 0 ? `full.${ext}` : `${i}.jpg`)
    );
  })();

  const photoElements = currentPhotosArray.map((photo, index) => {
    const photoDiv = document.createElement("div");
    photoDiv.classList.add("img_wrapper");
    const photoImg = document.createElement("img");
    const blurImg = document.createElement("img");

    photoImg.src = photo;
    photoImg.alt = "Фотосессия SLAM";

    if (index === 0) {
      photoDiv.classList.add("main_cover");
      photoImg.classList.add("main_cover_img");
      blurImg.classList.add("blur_img");
      blurImg.src = photo;
      blurImg.alt = "Фотосессия SLAM";
      photoDiv.appendChild(blurImg);
    }

    photoDiv.appendChild(photoImg);
    return photoDiv;
  });

  photoElements.forEach((element) => gallery.appendChild(element));

  const checkAndAddClasses = () => {
    let startIndex = 1;
    while (startIndex < photoElements.length) {
      let count = 0;
      let currentGroup = [];
      for (let i = startIndex; i < photoElements.length; i++) {
        const element = photoElements[i];
        const img = element.querySelector("img");
        currentGroup.push(element);
        count++;
        if (img.naturalWidth > img.naturalHeight) {
          element.classList.add("horizontal_photo");
          if (currentGroup.length > 1 && (currentGroup.length - 1) % 2 !== 0) {
            currentGroup[currentGroup.length - 2].classList.add("odd_photo");
          }
          startIndex = i + 1;
          currentGroup = [];
          break;
        }
        if (i === photoElements.length - 1) {
          if (currentGroup.length % 2 !== 0) {
            currentGroup[currentGroup.length - 1].classList.add("odd_photo");
          }
          startIndex = photoElements.length;
        }
      }
    }
  };

  Promise.all(
    photoElements.flatMap((element) => {
      const photoImgs = element.querySelectorAll("img");
      return Array.from(photoImgs).map((photoImg) => {
        return new Promise((resolve) => {
          photoImg.addEventListener("load", () => {
            photoImg.style.opacity = "1";
            resolve();
          });
        });
      });
    })
  ).then(checkAndAddClasses);

  openPopup(popupGallery);
  popupGalleryContent.scrollTop = 0;

  // Всё, что касается открытия попапа с галереей и ее свайпы
  const slidePopup = document.querySelector(".slide-popup");
  const slideWrapper = slidePopup.querySelector(".slide_wrapper");
  const prevButton = slidePopup.querySelector(".prev");
  const nextButton = slidePopup.querySelector(".next");

  let slides = [];
  let controlsAdded = false;

  function handleGalleryClick(event) {
    const target = event.target.closest("div");
    const index = Array.from(gallery.children).findIndex(
      (child) => child === target
    );

    if (index >= 0) {
      showFullsizeGallery(index - 1);
      openPopup(slidePopup);
    }
  }

  if (!galleryListenersAdded) {
    gallery.addEventListener("click", handleGalleryClick);
    galleryListenersAdded = true;
  }

  const showFullsizeGallery = (startIndex) => {
    slideWrapper.innerHTML = "";
    slides = [];
    currentSlide = startIndex;
    currentPhotosArray.forEach((photo, i) => {
      const slide = document.createElement("div");
      slide.classList.add("slide");
      const img = document.createElement("img");
      img.classList.add("slide_img");
      img.src = photo;
      img.alt = "Фотосессия SLAM";
      img.addEventListener("load", () => {
        img.style.opacity = "1";
      });
      slide.appendChild(img);
      slideWrapper.appendChild(slide);
      slides.push(slide);
    });

    updateSlider();
    if (!controlsAdded) {
      addControls();
      controlsAdded = true;
    }
    slideWrapper.addEventListener("click", handleSlideClick);
    if (!keydownListenerAdded) {
      document.addEventListener("keydown", handleKeyboard);
      keydownListenerAdded = true;
    }
  };

  const updateSlider = () => {
    const offset = window.innerWidth < 767 ? currentSlide * 20 : 0;
    const transformValue =
      window.innerWidth < 767
        ? `calc(-${currentSlide * 100}% - ${offset}px)`
        : `-${currentSlide * 100}%`;

    slideWrapper.style.transform = `translateX(${transformValue})`;
    updateButtonState();
  };
  const addControls = () => {
    prevButton.addEventListener("click", () => navigate(-1));
    nextButton.addEventListener("click", () => navigate(1));
  };
  const navigate = (direction) => {
    if (!isOpen) return;
    if (direction === -1 && currentSlide > 0) {
      currentSlide--;
    } else if (direction === 1 && currentSlide < slides.length - 1) {
      currentSlide++;
    }
    updateSlider();
  };
  const handleKeyboard = (e) => {
    if (!isOpen) return;
    e.preventDefault();
    switch (e.key) {
      case "ArrowLeft":
        navigate(-1);
        break;
      case "ArrowRight":
        navigate(1);
        break;
      case "ArrowUp":
      case "ArrowDown":
      case " ":
        return;
    }
  };
  const updateButtonState = () => {
    prevButton.disabled = currentSlide === 0;
    nextButton.disabled = currentSlide === slides.length - 1;
    prevButton.classList.toggle("disabled", currentSlide === 0);
    nextButton.classList.toggle("disabled", currentSlide === slides.length - 1);
  };

  const handleSlideClick = (event) => {
    if (!isOpen) return;
    const rect = slidePopup.getBoundingClientRect();
    const clickX = event.clientX - rect.left;
    const halfWidth = rect.width / 2;
    if (clickX < halfWidth) {
      navigate(-1);
    } else {
      navigate(1);
    }
  };
  window.addEventListener("resize", updateSlider);

  const mainCoverImg = popupGalleryContent.querySelector(".main_cover_img");
  const returnButton = popupGalleryContent.querySelector(".close");
  let maxScroll = 0;
  let currentPercent = 100;
  const threshold = 50;
  function updateDirection() {
    if (window.innerWidth > 767) {
      mainCoverImg.style.blockSize = "100%";
      mainCoverImg.style.inlineSize = "auto";
    } else {
      mainCoverImg.style.blockSize = "auto";
      mainCoverImg.style.inlineSize = "100%";
    }
  }
  function updateStyles(scroll) {
    const direction = window.innerWidth > 767 ? "blockSize" : "inlineSize";
    if (scroll >= 0) {
      currentPercent = 100 + scroll * 0.075;
      if (currentPercent > 175) {
        currentPercent = 175;
        maxScroll = scroll;
      }
    } else {
      currentPercent = 100;
    }
    mainCoverImg.style[direction] = `${currentPercent}%`;
    returnButton.classList.toggle("return-visible", scroll >= threshold);
  }
  popupGalleryContent.addEventListener("scroll", () => {
    const scroll = popupGalleryContent.scrollTop;
    updateStyles(scroll);
  }); // Анимация кнопки закрытия в попапе

  window.addEventListener("resize", () => {
    updateSlider();
    updateDirection();
  });
  updateDirection();
} // Открытие попапа с галереей
